<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>제품 등록 | JC Medical</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <section class="content-wrapper">
        <h2 class="section-title">제품 등록</h2>
        
        <form id="write-form" style="display:flex; flex-direction:column; gap:20px;">
            <input type="text" id="p-title" placeholder="제품명을 입력하세요" required style="padding:15px; font-size:16px;">
            
            <div style="background:#fff;">
                <label style="display:block; margin-bottom:10px; font-weight:600;">대표 이미지 첨부</label>
                <input type="file" id="p-image" accept="image/*">
            </div>

            <div id="editor" style="height: 400px; background:#fff;"></div>

            <div style="text-align:center; margin-top:30px; display:flex; gap:10px; justify-content:center;">
                <button type="button" class="btn" onclick="history.back()" style="background:#ccc;">취소</button>
                <button type="submit" class="btn btn-point">제품 저장하기</button>
            </div>
        </form>
    </section>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="app.js"></script>
    <script>
        // 에디터 초기화
        const quill = new Quill('#editor', { theme: 'snow', modules: { toolbar: [['bold', 'italic'], ['image', 'link'], [{ 'list': 'ordered'}, { 'list': 'bullet' }]] }});

        document.getElementById('write-form').onsubmit = async (e) => {
            e.preventDefault();
            const title = document.getElementById('p-title').value;
            const content = quill.root.innerHTML;
            const file = document.getElementById('p-image').files[0];
            
            let imageUrl = '';
            if (file) {
                const fileName = `${Date.now()}_${file.name}`;
                const { data, error } = await _supabase.storage.from('product-images').upload(fileName, file);
                if (data) {
                    const { data: urlData } = _supabase.storage.from('product-images').getPublicUrl(fileName);
                    imageUrl = urlData.publicUrl;
                }
            }

            const { error } = await _supabase.from('products').insert([{ title, content, image_url: imageUrl }]);
            if (!error) {
                alert("등록되었습니다.");
                location.href = 'product_list.html';
            }
        };
    </script>
</body>
</html>