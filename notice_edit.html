<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì œì´ì”¨ë©”ë””ì¹¼(JCMedical) | ë§ˆì¸ë“œë ˆì´Â·ì´ˆìŒíŒŒÂ·ì‹¬ì „ë„Â·ì˜ë£Œê¸°ê¸° ì „ë¬¸ ëŒ€ë¦¬ì </title>
  <meta name="description" content="ë§ˆì¸ë“œë ˆì´(Mindray) ê³µì‹ ëŒ€ë¦¬ì  ì œì´ì”¨ë©”ë””ì¹¼ì…ë‹ˆë‹¤. ê°€ì„±ë¹„ ë†’ì€ ì‹ í’ˆ ë° ì¤‘ê³  ì´ˆìŒíŒŒê¸°ê¸°, ì‚¼ì„±Â·ì•Œí”¼ë‹ˆì–¸ ì´ˆìŒíŒŒ, ë°”ì´ì˜¤ë„· ì‹¬ì „ë„ê¸°(Cardio7), íí™œëŸ‰ê³„, í™˜ìê°ì‹œëª¨ë‹ˆí„°, í† ë¥´ë¦¬í”„íŒ… ê³ ì£¼íŒŒê¸° ë“± ìµœì ì˜ ì˜ë£Œ ì†”ë£¨ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.">
  <meta name="keywords" content="ì œì´ì”¨ë©”ë””ì¹¼, jcë©”ë””ì¹¼, jcmedical, ë§ˆì¸ë“œë ˆì´, ì´ˆìŒíŒŒëŒ€ë¦¬ì , ì‹¬ì „ë„ê¸°, í™˜ìê°ì‹œëª¨ë‹ˆí„°, ì¤‘ê³ ì´ˆìŒíŒŒ">
  <meta name="robots" content="index, follow">
  <meta property="og:type" content="website">
  <meta property="og:title" content="ì œì´ì”¨ë©”ë””ì¹¼ - ë§ˆì¸ë“œë ˆì´ ì˜ë£Œê¸°ê¸° ì „ë¬¸">
  <meta property="og:description" content="ì´ˆìŒíŒŒ, ì‹¬ì „ë„, í™˜ìê°ì‹œëª¨ë‹ˆí„° ë“± ì˜ë£Œì¥ë¹„ ì†”ë£¨ì…˜ì˜ ì¤‘ì‹¬ JCMedical">
  <meta property="og:url" content="https://www.jcmedical.com/">
  <meta property="og:image" content="https://www.jcmedical.com/img/logo.png">
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "MedicalBusiness",
    "name": "ì œì´ì”¨ë©”ë””ì¹¼ (JCMedical)",
    "description": "ë§ˆì¸ë“œë ˆì´ ì´ˆìŒíŒŒ ì§„ë‹¨ê¸° ë° ë°”ì´ì˜¤ë„· ì‹¬ì „ë„ê¸°, í™˜ìê°ì‹œëª¨ë‹ˆí„° ì „ë¬¸ ìœ í†µì‚¬",
    "url": "https://www.jcmedical.com/",
    "telephone": "010-9474-6127",
    "address": {
      "@type": "PostalAddress",
	  "postalCode": "13647",
	  "addressRegion": "ê²½ê¸°",
      "addressLocality": "ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬",
	  "streetAddress": "ìœ„ë¡€ì„œë¡œ24, ìœ„ë¡€í–‰ë³µë¹Œë”©3ì¸µ 303í˜¸"
    },
    "keywords": "ë§ˆì¸ë“œë ˆì´, ì´ˆìŒíŒŒ, ì‹¬ì „ë„ê¸°, Cardio7, ì¤‘ê³  ì´ˆìŒíŒŒ, í† ë¥´ë¦¬í”„íŒ…"
  }
  </script>
  <meta name="author" content="JCMedical">  
  <link rel="canonical" href="https://www.jcmedical.com/">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/products.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/app.js" defer></script>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/quill-image-resize-module@latest/image-resize.min.js"></script>
</head>
<body>
<script>
async function checkAuth() {
    // ì´ì œ supabaseClientê°€ ë¡œë“œëœ í›„ì— ì‹¤í–‰ë˜ë¯€ë¡œ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    const { data: { user } } = await supabaseClient.auth.getUser();
    console.log(user);
    
    if (!user) {
        alert("ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
        location.href = 'index.html';
    }
}

// 1. DOMContentLoadedë¥¼ ì‚¬ìš©í•˜ì—¬ app.js(defer)ê°€ ì‹¤í–‰ëœ ì§í›„ì— ì‘ë™í•˜ê²Œ í•©ë‹ˆë‹¤.
window.addEventListener('DOMContentLoaded', () => {
    checkAuth();
    
    // ê¸°ì¡´ì˜ ì œí’ˆ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ë„ ì•„ë§ˆ ì—¬ê¸° ìˆê±°ë‚˜ ì´ ë°‘ì— ìˆì„ ê±°ì˜ˆìš”.
    // loadProductData(); 
});
</script>
<style>
.ql-editor img {
  max-width: 100%;
  height: auto;
  cursor: pointer;
}

.ql-editor .ql-image-handle {
  border: 1px solid #09f;
}
</style>
<header>
    <div class="header-inner">
        <a href="index.html" class="logo">
            <img src="img/logo_long.png" alt="JC Medical">
        </a>
        
        <nav class="nav">
            <ul class="nav-menu">
                <li class="nav-item">
					<a href="#">íšŒì‚¬ì†Œê°œ <span class="icon-plus">+</span><span class="icon-minus">-</span></a>
					<ul class="mobile-sub">
						<li><a href="about.html">ì¸ì‚¬ë§</a></li>
						<li><a href="about.html#location">ì˜¤ì‹œëŠ”ê¸¸</a></li>
					</ul>
				</li>
                <li class="nav-item">
					<a href="#">PRODUCT <span class="icon-plus">+</span><span class="icon-minus">-</span></a>
					<ul class="mobile-sub">
						<li><a href="products.html?cat=ultrasound">ì´ˆìŒíŒŒì§„ë‹¨ê¸°</a></li>
						<li><a href="products.html?cat=freq">ê³ ì£¼íŒŒê¸°ê¸°</a></li>
						<li><a href="products.html?cat=used">ì¤‘ê³ ì¥ë¹„</a></li>
					</ul>
				</li>
                <li class="nav-item">
					<a href="notice.html">ê³µì§€ì‚¬í•­</a>
				</li>
                <li class="nav-item">
					<a href="contact.html">ë¬¸ì˜í•˜ê¸°</a>
				</li>
            </ul>
        </nav>
		
		<div class="partner-logo">
			<img src="img/min_logo.png" alt="Mindray">
			<a href="http://pf.kakao.com/_pdvjn/chat" target="_blank"><img src="img/kakao.png" alt="kakao"></a>
			<a href="https://blog.naver.com/jcmedical0826" target="_blank"><img src="img/blog.png" alt="naver blog"></a>
		</div>
        
        <div class="hamburger">â˜°</div>
    </div>

    <div class="mega-menu">
        <div class="mega-inner">
            <div class="mega-col">
                <a href="about.html">ì¸ì‚¬ë§</a>
				<a href="about.html#location">ì˜¤ì‹œëŠ”ê¸¸</a>
            </div>
        
            <div class="mega-col">
                <a href="products.html?cat=ultrasound">ì´ˆìŒíŒŒì§„ë‹¨ê¸°</a>
				<a href="products.html?cat=freq">ê³ ì£¼íŒŒê¸°ê¸°</a>
                <a href="products.html?cat=used">ì¤‘ê³ ì¥ë¹„</a>
            </div>
        
            <div class="mega-col">
                <a href="notice.html">ê³µì§€ì‚¬í•­</a>
            </div>
        
            <div class="mega-col">
                <a href="contact.html">ë¬¸ì˜í•˜ê¸°</a>
            </div>
        </div>
    </div>
</header>

<section class="sub-visual">
    <div class="visual-text">
        <h2>NOTICE</h2>
        <p>JC Medicalì˜ ëŠì„ì—†ëŠ” ë„ì „ê³¼ ë³€í™”, ì´ê³³ì—ì„œ í™•ì¸í•˜ì„¸ìš”.</p>
    </div>
</section>

<div class="content-wrapper">
	<div class="write-container">
		<div class="write-header">
			<h3>ê³µì§€ì‚¬í•­ ìˆ˜ì •í•˜ê¸°</h3>
		</div>
	
		<form id="editForm" class="write-form">
			<div class="form-grid">				
				<div class="input-group">
					<label for="title">ì œëª©</label>
					<input type="text" id="title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
				</div>
			</div>
	
			<div class="input-group">
				<label>ë‚´ìš©</label>
				<div id="editor-container">
					<div id="editor" style="height: 300px;"></div>
				</div>
			</div>
	
			<div class="form-actions">
				<button type="button" class="btn-cancel" onclick="history.back()">ì·¨ì†Œ</button>
				<button type="submit" class="btn-submit" id="submitBtn">ìˆ˜ì • ì™„ë£Œ</button>
			</div>
		</form>
	</div>
</div>
    </section>

<script>
/* =================================================
   0. URL íŒŒë¼ë¯¸í„°ì—ì„œ notice id ê°€ì ¸ì˜¤ê¸°
================================================= */
const params = new URLSearchParams(window.location.search);
const noticeId = params.get('id');

if (!noticeId) {
  alert('ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.');
  location.href = 'notice.html';
}

/* =================================================
   1. Quill ì´ˆê¸°í™”
================================================= */
const quill = new Quill('#editor', {
  theme: 'snow',
  modules: {
    toolbar: {
      container: [
        [{ header: [1, 2, 3, false] }],
        ['bold', 'italic', 'underline'],
        ['image', 'link'],
        [{ list: 'ordered' }, { list: 'bullet' }],
        [{ color: [] }, { background: [] }]
      ],
      handlers: {
        image: imageHandler
      }
    }
  },
  imageResize: {
    parchment: Quill.import('parchment'),
    modules: ['Resize', 'DisplaySize', 'Toolbar']
  }
});

/* =================================================
   2. ì´ë¯¸ì§€ ì••ì¶• í•¨ìˆ˜
================================================= */
async function compressImage(file) {
  return new Promise((resolve) => {
    const reader = new FileReader();
    reader.readAsDataURL(file);

    reader.onload = (e) => {
      const img = new Image();
      img.src = e.target.result;

      img.onload = () => {
        const canvas = document.createElement('canvas');
        const maxWidth = 1200;
        let { width, height } = img;

        if (width > maxWidth) {
          height = height * (maxWidth / width);
          width = maxWidth;
        }

        canvas.width = width;
        canvas.height = height;

        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#fff'; // PNG íˆ¬ëª…ë„ ì œê±°
        ctx.fillRect(0, 0, width, height);
        ctx.drawImage(img, 0, 0, width, height);

        canvas.toBlob(
          (blob) => resolve(blob),
          'image/jpeg',
          0.7
        );
      };
    };
  });
}

/* =================================================
   3. Quill ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
================================================= */
async function imageHandler() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = 'image/*';
  input.click();

  input.onchange = async () => {
    const file = input.files[0];
    if (!file) return;

    try {
      const compressed = await compressImage(file);
      const fileName = `${Date.now()}_${crypto.randomUUID()}.jpg`;

      const { error } = await supabaseClient
        .storage
        .from('notice_img')
        .upload(fileName, compressed, {
          contentType: 'image/jpeg'
        });

      if (error) throw error;

      const { data } = supabaseClient
        .storage
        .from('notice_img')
        .getPublicUrl(fileName);

      const range = quill.getSelection();
      quill.insertEmbed(range.index, 'image', data.publicUrl);

    } catch (err) {
      console.error(err);
      alert('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨');
    }
  };
}

/* =================================================
   4. ì´ë¯¸ì§€ URL ì¶”ì¶œ í•¨ìˆ˜
================================================= */
function extractImageUrls(html) {
  const doc = new DOMParser().parseFromString(html, 'text/html');
  return [...doc.querySelectorAll('img')].map(img => img.src);
}

/* =================================================
   5. ê¸°ì¡´ ê³µì§€ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
================================================= */
let originalContent = '';

async function fetchProductData() {
  try {
    const { data, error } = await supabaseClient
      .from('notices')
      .select('*')
      .eq('id', noticeId)
      .single();

    if (error) throw error;

    document.getElementById('title').value = data.title;
    quill.root.innerHTML = data.content;

    // ğŸ”¥ ìˆ˜ì • ì „ content ì €ì¥ (ì´ë¯¸ì§€ ë¹„êµìš©)
    originalContent = data.content;

  } catch (err) {
    console.error(err);
    alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
    location.href = 'notice.html';
  }
}

/* =================================================
   6. ìˆ˜ì • ì €ì¥ ì²˜ë¦¬
================================================= */
document.getElementById('editForm').onsubmit = async (e) => {
  e.preventDefault();

  const submitBtn = document.getElementById('submitBtn');
  submitBtn.innerText = 'ìˆ˜ì • ì¤‘...';
  submitBtn.disabled = true;

  try {
    const title = document.getElementById('title').value.trim();
    const updatedContent = quill.root.innerHTML;

    if (!title || updatedContent === '<p><br></p>') {
      alert('ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.');
      return;
    }

    // ì´ë¯¸ì§€ ë¹„êµ
    const beforeImages = extractImageUrls(originalContent);
    const afterImages = extractImageUrls(updatedContent);

    const removedImages = beforeImages.filter(
      url => !afterImages.includes(url)
    );

    // âŒ ì‚­ì œëœ ì´ë¯¸ì§€ storageì—ì„œ ì œê±°
    for (const url of removedImages) {
      const path = url.split('/public/notice_img/')[1];
      if (!path) continue;

      await supabaseClient
        .storage
        .from('notice_img')
        .remove([path]);
    }

    // DB ì—…ë°ì´íŠ¸
    const { error } = await supabaseClient
      .from('notices')
      .update({
        title,
        content: updatedContent
      })
      .eq('id', noticeId);

    if (error) throw error;

    alert('ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
    location.href = 'notice.html';

  } catch (err) {
    console.error(err);
    alert('ìˆ˜ì • ì‹¤íŒ¨: ' + err.message);
  } finally {
    submitBtn.innerText = 'ìˆ˜ì • ì™„ë£Œ';
    submitBtn.disabled = false;
  }
};

/* =================================================
   7. í˜ì´ì§€ ë¡œë“œì‹œ ë°ì´í„° í˜¸ì¶œ
================================================= */
window.addEventListener('DOMContentLoaded', fetchProductData);
</script>
	    
</div>
<footer class="site-footer">
  <div class="footer-inner">

    <div class="footer-logo-area">
      <img src="img/logo.png" alt="JC Medical" class="footer-logo">
    </div>
	
	<div class="footer-text-area">
      <p class="footer-info">
        Address: ê²½ê¸°ë„ ì„±ë‚¨ì‹œ ìˆ˜ì •êµ¬ ìœ„ë¡€ì„œë¡œ24, ìœ„ë¡€í–‰ë³µë¹Œë”©3ì¸µ 303í˜¸<br>
        Tel: 070-4651-5088 | 010-9474-6127 <br>
        E-mail: jcmedi0826@naver.com<Br>
		ì‚¬ì—…ìë²ˆí˜¸: 512-13-30045
      </p>
	  
	  <div class="footer-links">
      <a href="policy.html?tab=terms">ì´ìš©ì•½ê´€</a>
      <span class="divider">|</span>
      <a href="policy.html?tab=privacy">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
    </div>
    </div>

  </div>

  <div class="footer-bottom">
    Â© 2025 JC Medical. All rights reserved.
  </div>
</footer>
</body>
</html>