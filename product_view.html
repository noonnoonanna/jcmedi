<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JCMedical</title>  
  <meta name="description" content="JCMedical Mindray 전문 대리점 초음파기기, 심전도, 환자감시모니터 등 의료 현장의 최적 솔루션을 제공합니다.">  
  <meta name="robots" content="index, follow">
  <meta name="author" content="JCMedical">  
  <link rel="canonical" href="https://www.jcmedical.com/">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/products.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/app.js" defer></script>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
</head>
<body>
<header>
    <div class="header-inner">
        <a href="index.html" class="logo">
            <img src="img/logo_long.png" alt="JC Medical">
        </a>
        
        <nav class="nav">
            <ul class="nav-menu">
                <li class="nav-item">
					<a href="#">회사소개 <span class="icon-plus">+</span><span class="icon-minus">-</span></a>
					<ul class="mobile-sub">
						<li><a href="about.html">인사말</a></li>
						<li><a href="about.html#location">오시는길</a></li>
					</ul>
				</li>
                <li class="nav-item">
					<a href="#">PRODUCT <span class="icon-plus">+</span><span class="icon-minus">-</span></a>
					<ul class="mobile-sub">
						<li><a href="products.html?cat=ultrasound">초음파진단기</a></li>
						<li><a href="products.html?cat=freq">고주파기기</a></li>
						<li><a href="products.html?cat=used">중고장비</a></li>
					</ul>
				</li>
                <li class="nav-item">
					<a href="notice.html">공지사항</a>
				</li>
                <li class="nav-item">
					<a href="contact.html">문의하기</a>
				</li>
            </ul>
        </nav>
		
		<div class="partner-logo">
			<img src="img/min_logo.png" alt="Mindray">
			<a href="http://pf.kakao.com/_pdvjn/chat" target="_blank"><img src="img/kakao.png" alt="kakao"></a>
			<a href="https://blog.naver.com/jcmedical0826" target="_blank"><img src="img/blog.png" alt="naver blog"></a>
		</div>
        
        <div class="hamburger">☰</div>
    </div>

    <div class="mega-menu">
        <div class="mega-inner">
            <div class="mega-col">
                <a href="about.html">인사말</a>
				<a href="about.html#location">오시는길</a>
            </div>
        
            <div class="mega-col">
                <a href="products.html?cat=ultrasound">초음파진단기</a>
				<a href="products.html?cat=freq">고주파기기</a>
                <a href="products.html?cat=used">중고장비</a>
            </div>
        
            <div class="mega-col">
                <a href="notice.html">공지사항</a>
            </div>
        
            <div class="mega-col">
                <a href="contact.html">문의하기</a>
            </div>
        </div>
    </div>
</header>

<section class="sub-visual">
    <div class="visual-text">
        <h2>PRODUCT</h2>
        <p>JC Medical이 제안하는 최첨단 의료 솔루션을 확인하세요.</p>
    </div>
</section>

<div class="content-wrapper">
	<div class="view-container">
		<div class="view-top-section">
			<div class="view-image-area">
				<img id="productImg" src="img/no-image.png" alt="제품 이미지">
			</div>
			<div class="view-info-area">
				<div class="category-tag" id="category">카테고리</div>
				<h2 class="product-title" id="title">제품명을 불러오는 중입니다...</h2>
			</div>
		</div>
	
		<div class="view-content-section">
			<div class="section-title">상세 정보</div>
			<div id="productContent" class="ql-editor">
				내용을 불러오는 중입니다...
			</div>
		</div>
	
		<div class="view-footer">
			<button type="button" class="btn-list" onclick="location.href='products.html'">목록으로</button>
		</div>
	</div>
</div>
    </section>

    <script>
	// 1. URL 파라미터에서 ID 가져오기
const urlParams = new URLSearchParams(window.location.search);
const productId = urlParams.get('id');

// 카테고리 매핑 객체
const categoryMap = {
    'ultrasound': '초음파',
    'freq': '고주파',
    'used': '중고장비'
};

async function fetchProductDetail() {
    if (!productId) {
        alert("해당 제품을 찾을 수 없습니다.");
        location.href = 'products.html';
        return;
    }

    try {
        const { data, error } = await supabaseClient
            .from('products')
            .select('*')
            .eq('id', productId)
            .single();

        if (error) throw error;

        // 데이터 반영
        document.getElementById('title').innerText = data.title;
        document.getElementById('category').innerText = categoryMap[data.category] || data.category;
        document.getElementById('productImg').src = data.image_url || 'img/no-image.png';
        
        // 상세 내용 (Quill HTML 적용)
        document.getElementById('productContent').innerHTML = data.content;

    } catch (err) {
        console.error(err);
        document.getElementById('productContent').innerText = "정보를 불러오는 중 오류가 발생했습니다.";
    }
}

// 페이지 로드 시 실행
window.addEventListener('DOMContentLoaded', fetchProductDetail);

// 모달 제어 변수
const modal = document.getElementById('imageModal');
const modalImg = document.getElementById('modalImg');
const closeBtn = document.querySelector('.close');

let scale = 1;
const ZOOM_SPEED = 0.0015; // 휠 속도 조절
const MAX_SCALE = 5;
const MIN_SCALE = 1;

window.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImg'); // ID 확인 필수!
    const closeBtn = document.querySelector('.close');

    if (!modalImg) return; // 에러 방지

    let scale = 1;
    let pointX = 0, pointY = 0;
    let start = { x: 0, y: 0 };
    let isPanning = false;
    let evCache = []; // 터치 포인트 저장용
    let prevDiff = -1;

    // 1. 이미지 클릭 시 모달 열기
    document.getElementById('productContent').addEventListener('click', (e) => {
        if (e.target.tagName === 'IMG') {
            modal.style.display = "block";
            modalImg.src = e.target.src;
            resetZoom();
        }
    });

    function resetZoom() {
        scale = 1; pointX = 0; pointY = 0;
        updateTransform();
    }

    function updateTransform() {
        modalImg.style.transform = `translate(calc(-50% + ${pointX}px), calc(-50% + ${pointY}px)) scale(${scale})`;
    }

    // 2. PC 휠 확대/축소
    modal.addEventListener('wheel', (e) => {
        e.preventDefault();
        const delta = e.deltaY > 0 ? -0.2 : 0.2;
        scale = Math.min(Math.max(1, scale + delta), 5);
        updateTransform();
    }, { passive: false });

    // 3. 모바일 터치 (핀치 줌 & 드래그)
    modalImg.onpointerdown = (e) => {
        evCache.push(e);
        isPanning = true;
        start = { x: e.clientX - pointX, y: e.clientY - pointY };
    };

    modalImg.onpointermove = (e) => {
        // 터치 포인트 업데이트
        const index = evCache.findIndex((ev) => ev.pointerId === e.pointerId);
        evCache[index] = e;

        // 두 손가락 터치 시 (핀치 줌)
        if (evCache.length === 2) {
            const curDiff = Math.hypot(evCache[0].clientX - evCache[1].clientX, evCache[0].clientY - evCache[1].clientY);
            if (prevDiff > 0) {
                if (curDiff > prevDiff) scale += 0.05;
                else if (curDiff < prevDiff) scale -= 0.05;
                scale = Math.min(Math.max(1, scale), 5);
            }
            prevDiff = curDiff;
        } 
        // 한 손가락 혹은 마우스 드래그 (이동)
        else if (isPanning) {
            pointX = e.clientX - start.x;
            pointY = e.clientY - start.y;
        }
        updateTransform();
    };

    modalImg.onpointerup = (e) => {
        evCache = evCache.filter((ev) => ev.pointerId !== e.pointerId);
        if (evCache.length < 2) prevDiff = -1;
        isPanning = false;
    };

    // 4. 닫기 기능
    const closeModal = () => {
        modal.style.display = "none";
        resetZoom();
    };

    closeBtn.onclick = closeModal;
    modal.onclick = (e) => { if (e.target === modal) closeModal(); };
});
    </script>	    
</div>
<footer class="site-footer">
  <div class="footer-inner">

    <div class="footer-logo-area">
      <img src="img/logo.png" alt="JC Medical" class="footer-logo">
    </div>
	
	<div class="footer-text-area">
      <p class="footer-info">
        Address: 경기도 성남시 수정구 위례서로24, 위례행복빌딩3층 303호<br>
        Tel: 070-4651-5088 | 010-9474-6127 <br>
        E-mail: jcmedi0826@naver.com<Br>
		사업자번호: 512-13-30045
      </p>
	  
	  <div class="footer-links">
      <a href="policy.html?tab=terms">이용약관</a>
      <span class="divider">|</span>
      <a href="policy.html?tab=privacy">개인정보처리방침</a>
    </div>
    </div>

  </div>

  <div class="footer-bottom">
    © 2025 JC Medical. All rights reserved.
  </div>
</footer>
<div id="imageModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImg">
    <div id="caption"></div>
</div>
<style>
/* 이미지 모달 스타일 보강 */
.modal {
    display: none;
    position: fixed;
    z-index: 2000; /* 헤더보다 높게 */
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.85);
    overflow: hidden; /* 모달 오픈 시 스크롤 방지 */
    backdrop-filter: blur(5px);
    cursor: zoom-out;
}

#modalImg {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 90%;
    transition: transform 0.1s ease-out; /* 확대/축소 부드럽게 */
    cursor: grab; /* 잡을 수 있는 모양 */
    user-select: none;
    -webkit-user-drag: none;
    position: relative;
    top: 50%;
    transform: translateY(-50%) scale(1);
}

#modalImg:active {
    cursor: grabbing;
}

.close {
    position: absolute;
    top: 20px; right: 35px;
    color: #fff;
    font-size: 40px;
    font-weight: bold;
    cursor: pointer;
    z-index: 2100;
}
</style>
</body>
</html>